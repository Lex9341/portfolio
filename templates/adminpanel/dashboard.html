{% extends "adminpanel/base_admin.html" %}
{% block content %}
<h1>üìä Dashboard</h1>

<section class="stats-grid">
    <div class="stat-card"><h3>–ü—Ä–æ–µ–∫—Ç—ã</h3><p>{{ stats.projects_count }}</p></div>
    <div class="stat-card"><h3>–ù–∞–≤—ã–∫–∏</h3><p>{{ stats.skills_count }}</p></div>
    <div class="stat-card"><h3>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3><p>{{ stats.users_count }}</p></div>
</section>

<div class="charts-grid">
    <div class="chart-box">
        <h3>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤ –ø–æ —Ç–µ–≥–∞–º</h3>
        <canvas id="tagsChart"></canvas>
    </div>

    <div class="chart-box">
        <h3>–£—Ä–æ–≤–Ω–∏ –Ω–∞–≤—ã–∫–æ–≤</h3>
        <canvas id="skillsChart"></canvas>
    </div>

    <div class="chart-box full">
        <h3>–ü—Ä–æ–µ–∫—Ç—ã –ø–æ –º–µ—Å—è—Ü–∞–º</h3>
        <canvas id="monthlyChart"></canvas>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    // –¢–µ–≥–∏
    const tagsData = {{ tags_data|safe }};
    new Chart(document.getElementById("tagsChart"), {
        type: "pie",
        data: {
            labels: tagsData.map(t => t.name),
            datasets: [{
                data: tagsData.map(t => t.projects_count),
                backgroundColor: ["#4CAF50","#2196F3","#FF9800","#9C27B0","#E91E63"]
            }]
        }
    });

    // –ù–∞–≤—ã–∫–∏
    const skillsData = {{ skills_data|safe }};
    new Chart(document.getElementById("skillsChart"), {
        type: "bar",
        data: {
            labels: skillsData.map(s => s.name),
            datasets: [{
                label: "Level",
                data: skillsData.map(s => s.level),
                backgroundColor: "#7cf3ff"
            }]
        },
        options: { scales: { y: { beginAtZero: true, max: 100 } } }
    });

    // –ü—Ä–æ–µ–∫—Ç—ã –ø–æ –º–µ—Å—è—Ü–∞–º
    const monthlyData = {{ monthly_data|safe }};
    const months = ["–Ø–Ω–≤","–§–µ–≤","–ú–∞—Ä","–ê–ø—Ä","–ú–∞–π","–ò—é–Ω","–ò—é–ª","–ê–≤–≥","–°–µ–Ω","–û–∫—Ç","–ù–æ—è","–î–µ–∫"];
    new Chart(document.getElementById("monthlyChart"), {
        type: "line",
        data: {
            labels: monthlyData.map(m => months[parseInt(m.month)-1]),
            datasets: [{
                label: "–ü—Ä–æ–µ–∫—Ç—ã",
                data: monthlyData.map(m => m.count),
                borderColor: "#4CAF50",
                fill: false,
                tension: 0.3
            }]
        }
    });
});
</script>
{% endblock %}
